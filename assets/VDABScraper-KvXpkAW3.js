import{chromium as D}from"playwright";class V{constructor(){this.name="VDAB",this.location="Gent",this.distance=30}async scrape(h,g){var o,l;const s=`https://www.vdab.be/vindeenjob/vacatures?trefwoord=${encodeURIComponent(h)}&locatie=9000%20Gent&afstand=20&sort=standaard`;console.log(`[VDAB] Fetching via Playwright: ${s}`);let t;try{t=await D.launch({headless:!1});const e=await t.newPage();await e.setExtraHTTPHeaders({"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","Accept-Language":"nl-BE,nl;q=0.9,en;q=0.8"}),await e.goto(s,{waitUntil:"domcontentloaded",timeout:6e4});try{await e.waitForSelector("li.c-vacature",{timeout:1e4}),console.log("[VDAB] Job cards loaded successfully!")}catch{console.log("[VDAB] Timeout waiting for li.c-vacature. Checking if results exist...")}await e.waitForTimeout(2e3);const{items:a,logBuffer:d}=await e.evaluate(()=>{const u=[],n=[],f=document.querySelectorAll("li.c-vacature");return n.push(`Found ${f.length} job listings using li.c-vacature selector.`),f.length===0?(n.push("ERROR: No job listings found with selector li.c-vacature"),n.push("Page might have changed structure or search returned no results."),{items:u,logBuffer:n.join(`
`)}):(f.forEach((p,w)=>{var v,y,A;try{const i=p.querySelector(".c-vacature__content-title a"),m=p.querySelector(".c-vacature-meta.-location strong:nth-of-type(1)"),b=p.querySelector(".c-vacature-meta.-location strong:nth-of-type(2)");let r="";i&&(r=i.getAttribute("href")||""),r&&!r.startsWith("http")&&(r=`https://www.vdab.be${r}`),i&&r?u.push({id:r,title:((v=i.textContent)==null?void 0:v.trim())||"Unknown Job",price:"N/A",location:((y=b==null?void 0:b.textContent)==null?void 0:y.trim())||"Gent area",url:r,seller:((A=m==null?void 0:m.textContent)==null?void 0:A.trim())||"See listing",source:"VDAB",description:""}):w<3&&n.push(`Skipped ${w}: Title=${!!i}, Href=${!!r}`)}catch(i){n.push(`Error processing listing ${w}: ${i}`)}}),{items:u,logBuffer:n.join(`
`)})});return console.log(`[VDAB] Evaluation logs:
${d}`),a.length===0?(console.log("[VDAB] No items found. Capturing debug snapshot."),await e.screenshot({path:"debug_vdab.png",fullPage:!0}),(void 0)("debug_vdab.html",await e.content())):console.log(`[VDAB] Successfully scraped ${a.length} jobs.`),await this.fetchFullDescriptions(t,a)}catch(e){if(console.error(`[VDAB] Playwright Error: ${e}`),t)try{await((l=(o=t.contexts()[0])==null?void 0:o.pages()[0])==null?void 0:l.screenshot({path:"debug_vdab_error.png"}))}catch{}return[]}finally{t&&await t.close()}}async fetchFullDescriptions(h,g){console.log(`[VDAB] Fetching full descriptions for ${g.length} jobs...`);const s=[];for(const t of g.slice(0,10))try{const o=await h.newPage();await o.goto(t.url,{waitUntil:"domcontentloaded",timeout:3e4}),await o.waitForTimeout(1500);const l=await o.evaluate(()=>{var a;const e=['[data-testid="job-description"]',".job-description",".vacancy-description","article","main"];for(const d of e){const c=document.querySelector(d);if(c&&c.textContent&&c.textContent.length>100)return c.textContent.trim()}return((a=document.body.textContent)==null?void 0:a.trim())||""});s.push({...t,description:l.substring(0,5e3)}),await o.close(),console.log(`[VDAB] âœ“ Fetched description for: ${t.title}`)}catch(o){console.error(`[VDAB] Failed to fetch description for ${t.title}:`,o),s.push(t)}return s}}export{V as VDABScraper};
